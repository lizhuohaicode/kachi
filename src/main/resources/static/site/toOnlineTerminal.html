<!DOCTYPE html>
<html>
  <head>
    <title>在线终端管理</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
	<link rel="stylesheet" type="text/css" href="../css/easyui/themes/default/easyui.css" rel="stylesheet" title="blue"/>
	<link rel="stylesheet" type="text/css" href="../css/easyui/themes/icon.css"/>
	<script type="text/javascript" src="../js/jquery-1.6.3.min.js"></script>
	<script type="text/javascript" src="../js/jquery.easyui.min.js"></script>
	<script type="text/javascript" src="../js/easyui-lang-zh_CN.js"></script>
	<script type="text/javascript" src="../js/common.js"></script>
  </head>
  <body>
  		<form id="queryForm">
	  		<table class="table">
	  			<tr>
	  				<th>终端编号：</th><td><input name="tsid" placeholder="请输入终端编号" class="onlyNumber"/></td>
	  				<th>所属部门：</th><td><select name="departmentId"></select></td>
	  				<th>IMSI码：</th><td><input name="imsi" placeholder="请输入IMSI码" class="onlyNumber"/></td>
	  				<td><a id="search_btn" class="easyui-linkbutton" iconCls="icon-search" plain="true" onclick="doQuery()">查 询</a></td>
	  			</tr>
	  		</table>
	  	</form>
	  	<div id="dg"></div>
	  	
	  	<div id="detailDialog" closed="true" style="padding:10px;overflow:hidden;background:#FFF;" iconCls="icon-user">
	  		<table class="table readOnly">
	  			<tr><td>终端编号</td><td><input name="tsid"/></td></tr>
	  			<tr><td>IMSI码</td><td><input name="imsi"/></td></tr>
	  			<tr><td>MCC</td><td><input name="mcc"/></td></tr>
	  			<tr><td>最后心跳时间</td><td><input name="beatTime"/></td></tr>
	  			<tr><td>选卡时间</td><td><input name="date"/></td></tr>
	  			<tr><td>是否是在归属地</td><td><select name="reserve"><option value=""></option><option value="0">是</option><option value="1">否</option></select></td></tr>
	  			<tr><td>副卡IMSI</td><td><input name="eCardImsi"/></td></tr>
	  			<tr><td>副卡时延</td><td><input name="eCardDuration"/></td></tr>
	  			<tr><td>当前版本</td><td><input name="runVersion"/></td></tr>
	  			<tr><td>国家代码</td><td><input name="vCountryCode"/></td></tr>
	  			<tr><td>国家</td><td><input name="countryName"/></td></tr>
	  			<tr><td>所属部门</td><td><input name="departmentName"/></td></tr>
	  		</table>
	  	</div>
  </body>
  <script type="text/javascript">
  	var options={
			title:'终端设备列表',
			queryParams:$('#queryForm').serializeObject(),
			columns:[[
						{field:'ck',checkbox:true}, 
			         	{field:'id',title:'id',hidden:true},
			         	{field:'tsid',title:'终端编号',width:80},
			         	{field:'imsi',title:'IMSI码',width:120},
			         	{field:'mcc',title:'MCC码',width:100},
			         	{field:'groupKey',title:'GROUPKEY',width:120},
			         	{field:'beatTime',title:'最后心跳时间',width:150},
			         	{field:'date',title:'选卡时间',width:150},
			         	{field:'reserve',title:'是否是在归属地',width:100,formatter:function(value,rec,index){
			         		value = (value+'').replace('null','');
			         		return value?(value=='0'?'是':'否'):'';
			         	}},
			         	{field:'countryName',title:'国家',width:100},
			         	{field:'departmentName',title:'所属部门',width:120}
					]],
			toolbar: kcJs.fn.getFunctions(),
			url:kcJs.fn.getContextPath()+'/terminalSim/list',
			iconCls:'icon-tip',
			nowrap:false,
			pagination:true,
			pageList:[20,30,50],
			rownumbers:true,
			scrollbarSize:0,
			striped:true,
			height:window.innerHeight-50
		};
		
  
	$(function(){
		$('#dg').datagrid(options);
		
		$('#detailDialog').dialog({
			modal : true,
   			width:400,
   			height:460,
   			cache: false,
			title : "详细信息"
		});
		
		kcJs.fn.initSelect({"container":$('[name=departmentId]'),"url":'getDepartmentDic',"nullDesc":"全部"});
	});
	
	function doQuery(){
  		options.queryParams = $('#queryForm').serializeObject();
  		$('#dg').datagrid(options);
  	}
  
  	function doDelete(){
  		var selectRows = $('#dg').datagrid("getSelections");
  		if (selectRows.length > 0) {
  			$.messager.confirm('提示','是否确定删除？',function(r){
  				if(r){
  					$('#dg').datagrid('loading');
		  			var ids = [];
		  			var TSIDs=[];
		  			for(var i = 0;i < selectRows.length;i++){
		  				ids.push(selectRows[i].id);
		  				TSIDs.push(selectRows[i].tsid);
		  			}
		  			$.post(kcJs.fn.getContextPath()+'/terminalSim/delete',{ids:ids.join(","),TSIDs:TSIDs.join(",")},function(data){
		  				if(data && data.code && data.code == '200'){
		  					doQuery();	
		  				}else{
		  					$('#dg').datagrid('loaded');
		  				}
		  				$.messager.alert("提示", data.msg, "info");
		  			},'json');
		  		}
  			});
        }else {
            $.messager.alert("提示", "请选择至少一条信息", "info");
        }
  	}
  	
  	function doDetail(){
  		var selectRows = $('#dg').datagrid("getSelections");
  		if (selectRows.length > 0 && selectRows.length == 1) {
             var rowData = $('#dg').datagrid("getSelected");
             console.log(rowData);
			 kcJs.fn.autoFillData($('#detailDialog'),rowData);
			 $('#detailDialog').dialog('open');
        }else {
            $.messager.alert("提示", "请选择其中一条信息", "info");
        }
  	}
  </script>
</html>
