<!DOCTYPE html>
<html>
  <head>
    <title>指定卡管理</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
	<link rel="stylesheet" type="text/css" href="../css/easyui/themes/default/easyui.css" rel="stylesheet" title="blue"/>
	<link rel="stylesheet" type="text/css" href="../css/easyui/themes/icon.css"/>
	<script type="text/javascript" src="../js/jquery-1.6.3.min.js"></script>
	<script type="text/javascript" src="../js/jquery.easyui.min.js"></script>
	<script type="text/javascript" src="../js/easyui-lang-zh_CN.js"></script>
	<script type="text/javascript" src="../js/common.js"></script>
  </head>
  <body>
		  	<form id="queryForm">
		  		<table class="table">
		  			<tr>
		  				<th>指定卡IMSI：</th><td><input name="imsi" placeholder="请输入指定卡IMSI" onkeyup="this.value=this.value.replace(/\D/,'')"/></td>
		  				<th>终端ID：</th><td><input name="tsid" placeholder="请输入终端ID" onkeyup="this.value=this.value.replace(/\D/,'')"/></td>
		  				<td><a id="search_btn" class="easyui-linkbutton" iconCls="icon-search" plain="true" onclick="doQuery()">查 询</a></td>
		  			</tr>
		  		</table>
		  	</form>
		  	<div id="dg"></div>
		  	<div id="dia"   closed="true" style="width:500px;">
				<form id="doForm" style="padding:10px 20px 10px 40px;">
					<input type="hidden" name="id" value="">
					<table class="table">
			  			<tr><th>IMSI：</th><td><input name="imsi"  class="easyui-validatebox onlyNumber" required="true"/></td></tr>
			  			<tr><th>TSID：</th><td><input name="tsid"  class="easyui-validatebox onlyNumber" required="true"/></td></tr>
			  			<tr><th>指定日期：</th><td><input name="insertDate" readonly/></td></tr>
			  			<tr><th>指定前状态：</th><td><select name="lastStatus">
			  					<option value="0">正常</option>
			  					<option value="1">停用</option>
			  				</select></tr>
	<!-- 		  				<input name="lastStatus" /></td> -->
			  			<tr><th>操作人：</th><td><input name="operator"/></td></tr>
			  			<tr><th>指定类型：</th><td><select name="type">
			  					<option value="0">临时指定</option>
			  					<option value="1">一直指定</option>
			  				</select></tr>
	<!-- 		  				<input name="type"/></td> -->
			  			
			  		</table>
					<div style="padding:5px;text-align:center;">
						<a href="#" class="easyui-linkbutton" icon="icon-ok" onclick="saveData()">保存</a>
					</div>
				</form>
			</div>
		
						
		     
  </body>
  <script type="text/javascript">
  var options={
			title:'指定卡列表',
			queryParams:$('#queryForm').serializeObject(),
			columns:[[
						{field:'ck',checkbox:true}, 
			         	{field:'id',title:'指定卡id',hidden:true},
			         	{field:'imsi',title:'IMSI',width:140},
			         	{field:'tsid',title:'卡号',width:140},
// 			         	{field:'status',title:'状态',width:100,formatter:function(value,rec,index){
// 			         		return '<div style="border-radius:8px;color:#fff;width:90px;text-align:center" class="'+(value=="0"?"blue":"red")+'">'+(value=="0"?"正常":"停用")+'</div>';
// 			         	}},
// 			         	{field:'insertDate',title:'指定时间',width:140,formatter:function(value,rec,index){
// 			         		return kcJs.fn.getDate(value,'yyyy-MM-dd hh:mm:ss');
// 			         	}},
			         	{field:'insertDate',title:'指定时间',width:100},
			         	{field:'lastStatus',title:'指定前卡状态',width:140,formatter:function(value,rec,index){
			         		var status = kcJs.fn.getCardStatus(value+'');
			         		return status?'<div style="border-radius:8px;color:#fff;width:90px;text-align:center;background:'+status[1]+'">'+status[0]+'</div>':'';
			         	}},
			         	{field:'operator',title:'操作人',width:100},
			         	{field:'type',title:'指定类型',width:150,formatter:function(value,rec,index){
			         		var status = kcJs.fn.getReadyType(value+'');
			         		return status?'<div style="border-radius:8px;color:#fff;width:140px;text-align:center;background:'+status[1]+'">'+status[0]+'</div>':'';
			         	}},
					]],
			toolbar: [{
				  		iconCls: 'icon-add',
				  		text:'添加',
				  		handler: doAdd
				  	  },'-',{
				  		iconCls: 'icon-edit',
				  		text:'修改',
				  		handler: doModify
				  	  },'-',{
				  		iconCls: 'icon-cancel',
				  		text:'删除',
				  		handler: doDelete
				  	  }
				  	 ],
			url:kcJs.fn.getContextPath()+'/getReadyTerminalSim',
			iconCls:'icon-tip',
			nowrap:false,
			pagination:true,
			pageList:[15,30],
			rownumbers:true,
			scrollbarSize:0,
			height:window.innerHeight*0.89
		};
  
	$(function(){
		$('#dg').datagrid(options);
		
		$('#dia').dialog({
			modal : true,
 			width:400,
 			height:400,
 			cache: false,
			title : "指定卡信息"
		});
		
	});
	
	function doAdd(){
		$('#doForm')[0].reset();
		$('#dia [name=id]').val('');
		//$('#dia [name=tsid]').attr('readOnly',false);
		$('#dia').dialog('open');
	}
	
	
	function doModify(){
		var selectRows = $('#dg').datagrid("getSelections");
		if (selectRows.length > 0 && selectRows.length == 1) {
           var rowData = $('#dg').datagrid("getSelected");
           kcJs.fn.autoFillData($('#dia'),rowData);
           $('#dia').dialog('open');
           //$('#doDialog [name=tsid]').attr('readOnly',true);
      }
      else {
          $.messager.alert("提示", "请选择其中一条信息", "info");
      }
	}
	
	function doDelete(){
		var selectRows = $('#dg').datagrid("getSelections");
		if (selectRows.length > 0) {
			$.messager.confirm('提示','是否确定删除？',function(r){
				if(r){
					$('#dg').datagrid('loading');
		  			var ids = [];
		  			for(var i = 0;i < selectRows.length;i++){
		  				ids.push(selectRows[i].id);
		  			}
		  			$.post(kcJs.fn.getContextPath()+'/deleteReadyTerminalSim',{ids:ids.join(",")},function(data){
		  				if(data && data.code && data.code == '200'){
		  					doQuery();	
		  				}else{
		  					$('#dg').datagrid('loaded');
		  				}
		  				$.messager.alert("提示", data.msg, "info");
		  			},'json');
		  		}
			});
      }else {
          $.messager.alert("提示", "请选择至少一条信息", "info");
      }
	}
	
	
	function saveData(){
		if($('#doForm').form('validate')){
			$('#dia').dialog('close');
			$('#dg').datagrid('loading');
			$.post(kcJs.fn.getContextPath()+'/saveReadyTerminalSim',$('#doForm').serializeObject(),function(data){
				if(data){
	    			$.messager.alert('提示',data.msg,'info');
	    			if(data.code=='200'){
	    				doQuery();
	    			}else{
	    				$('#dg').datagrid('loaded');
	    			}
	    		}
	    		
			});
		}
	}
	
	function doQuery(){
		options.queryParams = $('#queryForm').serializeObject();
		$('#dg').datagrid(options);
	}

  </script>
</html>
