<!DOCTYPE html>
<html>
<head>
    <title>问题卡</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <link rel="stylesheet" type="text/css" href="../css/easyui/themes/default/easyui.css" rel="stylesheet"
          title="blue"/>
    <link rel="stylesheet" type="text/css" href="../css/easyui/themes/icon.css"/>
    <script type="text/javascript" src="../js/jquery-1.6.3.min.js"></script>
    <script type="text/javascript" src="../js/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="../js/easyui-lang-zh_CN.js"></script>
    <script type="text/javascript" src="../js/common.js"></script>
</head>
<body id="main-layout" class="easyui-layout" style="overflow-y: hidden" scroll="no">
<div region="center" title="" style="overflow:hidden;background:#FFF;padding-left:2px" border="false">
    <table id="dg"></table>
</div>

<div id="doDialog" closed="true" style="padding:0 10px;overflow:auto;background:#FFF;" iconCls="icon-user">
    <form id="doForm">
        <table class="table th-normal">
            <tr>
                <th>定时时间：</th>
                <td><input name="minute" class="easyui-validatebox onlyNumber" required="true"/></td>
                <th>分钟</th>
            </tr>
            <tr>
                <th>定时扫描：</th>
                <td colspan="2"><select name="status">
                    <option value="0">开启</option>
                    <option value="1">关闭</option>
                </select></td>
            </tr>
            <tr>
                <th>处理问题卡：</th>
                <td colspan="2"><select name="isHandle">
                    <option value="0">开启</option>
                    <option value="1">关闭</option>
                </select></td>
            </tr>
            <tr style="height:10px"></tr>
            <tr>
                <td colspan="4" align="center" class="noborder"><a class="easyui-linkbutton" iconCls="icon-ok"
                                                                   plain="true" onclick="saveData()">提 交</a></td>
            </tr>
        </table>
    </form>
</div>
</body>
<script type="text/javascript">
    var options = {
        title: '问题卡列表',
        columns: [[
            {field: 'imsi', title: 'IMSI', width: 150},

            {
                field: 'status', title: '卡当前状态', width: 100, formatter: function (value, rec, index) {
                var status = kcJs.fn.getCardStatus(value + '');
                return status ? '<div style="border-radius:8px;color:#fff;width:90px;text-align:center;background:' + status[1] + '">' + status[0] + '</div>' : '';
            }
            },
//            {field: 'createTime', title: '扫描时间', width: 150},
        ]],
        url: kcJs.fn.getContextPath() + '/simcard/listProblemCard',
			toolbar: kcJs.fn.getFunctions(),
        iconCls: 'icon-tip',
        nowrap: false,
        rownumbers: true,
        striped: true,
        scrollbarSize: 0,
        fit: true
    };


    $(function () {
        $('#dg').datagrid(options);

        $('#doDialog').dialog({
            modal: true,
            width: 400,
            height: 200,
            cache: false,
            title: "修改定时时间",
        });

    });

    function doRest() {
        $.post(kcJs.fn.getContextPath()+'/quartz/getNow',{},function (data) {
            $('#doForm [name=minute]').val(data.minute);
            $('#doForm [name=status]').val(data.status);
            $('#doForm [name=isHandle]').val(data.isHandle);
        },'json');
        $('#doDialog').dialog('open');
    }

    function saveData() {
        if ($('#doForm').form('validate')) {
            $('#doDialog').dialog('close');
            $('#dg').datagrid('loading');
            $.post(kcJs.fn.getContextPath() + '/quartz/reset', $('#doForm').serializeObject(), function (data) {
                if (data) {
                    $.messager.alert('提示', data.msg, 'info');
                    if (data.code == '200') {
                        doQuery();
                    } else {
                        $('#dg').datagrid('loaded');
                    }
                }

            });
        }
    }

    function doQuery() {
        $('#dg').datagrid(options);
    }
</script>
</html>	