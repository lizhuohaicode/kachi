<!DOCTYPE html>
<html>
  <head>
    <title>卡池管理</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<link rel="stylesheet" type="text/css" href="../css/easyui/themes/default/easyui.css" rel="stylesheet" title="blue"/>
	<link rel="stylesheet" type="text/css" href="../css/easyui/themes/icon.css"/>
	<script type="text/javascript" src="../js/jquery-1.6.3.min.js"></script>
	<script type="text/javascript" src="../js/jquery.easyui.min.js"></script>
	<script type="text/javascript" src="../js/jquery.tooltip.js"></script>
	<script type="text/javascript" src="../js/easyui-lang-zh_CN.js"></script>
	<script type="text/javascript" src="../js/common.js"></script>
	<style type="text/css">
		.card_container{width:100%;border:1px solid transparent;height:200px}
		.card_container:after{display:block;content:'';height:0;clear:both}
		.box{width:20px;height:10px;margin:5px;float:left;cursor:pointer}
		.title{padding:5px 10px;border-radius:4px;color:#fff;font-size:13px;background:rgb(67,116,224);display:inline-block;margin-bottom:10px}
		.table{border-collapse:collapse;width:100%}
		.table .td{padding:2px 5px}
	</style>
  </head>
  
  <body>
  	<form id="queryForm">
  		<table class="table">
  			<tr>
  				<td>卡池编号：</td><td><input name="spid" placeholder="请输入卡池编号" onkeyup="this.value=this.value.replace(/\D/,'')"/></td>
  				<td>卡池名称：</td><td><input name="name" placeholder="请输入卡池名称"/></td>
  				<td>卡池状态：</td>
  				<td><select name="isActive" placeholder="请输入卡池名称"><option value="">全部</option><option  value="1">正常</option><option value="0">暂停</option></select></td>
  				<td><a id="search_btn" class="easyui-linkbutton" iconCls="icon-search" plain="true" onclick="doQuery()">查询</a></td>
  			</tr>
  		</table>
  	</form>
  	<div id="dg"></div>
    <div id="cardsDialog" closed="true" style="padding:10px 20px;overflow:hidden;background:#FFFFFF;" iconCls="icon-user">
    	<div class="title"></div>
    	<div class="card_container" ></div>
    </div>
  </body>
  <script type="text/javascript">
  	var options={
			title:'卡池设备列表',
			queryParams:$('#queryForm').serializeObject(),
			columns:[[
						{field:'ck',checkbox:true}, 
			         	{field:'id',title:'卡池id',hidden:true},
			         	{field:'spid',title:'卡池编号',width:80},
			         	{field:'name',title:'卡池名称',width:100},
			         	{field:'isActive',title:'活动状态',width:100,formatter:function(value,rec,index){
			         		return '<div style="color:#fff;width:90px;text-align:center;background:'+(value=="1"?colors.blue:colors.red)+'">'+(value=="1"?"正常":"暂停")+'</div>';
			         	}},
			         	{field:'oupIp',title:'卡池外网IP',width:100},
			         	{field:'type',title:'卡池类型',width:100},
			         	{field:'mac',title:'卡池物理地址',width:120},
			         	{field:'version',title:'卡池版本',width:100},
			         	{field:'port',title:'卡池端口',width:100},
			         	{field:'departmentName',title:'所属部门',width:150}
					]],
			toolbar: [{
				  		iconCls: 'icon-yj-log',
				  		text:'查看卡信息',
				  		handler: doCardsInfo
				  	},'-',{
				  		iconCls: 'icon-edit',
				  		text:'调整归属商',
				  		handler: doModifyDept
				  	}],
			url:getContextPath()+'/getSimPoolByDept',
			iconCls:'icon-tip',
			nowrap:false,
			pagination:true,
			pageList:[15,30],
			rownumbers:true,
			scrollbarSize:0,
		};
  
	$(function(){
		$('#dg').datagrid(options);
		
		$('#cardsDialog').dialog({
			modal : true,
   			resizable:true,
   			width:800,
   			height:350,
   			cache: false,
			title : "卡池对应卡信息"
		});
		
	});
  
  	function doCardsInfo(){
  		var selectRows = $('#dg').datagrid("getSelections");
  		if (selectRows.length > 0 && selectRows.length == 1) {
             var rowData = $('#dg').datagrid("getSelected");
             $.getJSON(getContextPath()+'/getSimCardByPool/'+rowData.id,function(data){
             	var cardList = data.rows;
             	if(cardList && cardList.length>0){
             		$('.card_container').html('');
             		var total = rowData.type?rowData.type:cardList.length;
             		var count = 0;
             		for(var i = 0;i < total;i++){
             			var box = v_status["1"];
             			if((count < cardList.length) && ((i+1) == cardList[count].cpChannelId)){
             				box = v_status[cardList[count].status];
             				count ++;
             			}
             			$('<div class="box" color="'+box[1]+'" style="background:'+box[1]+'"></div>').appendTo($('.card_container'))
             			.tooltip({
						    position: 'top',
						    content: '<div style="padding:5px 10px;color:#fff">通道编号：'+(i+1)+'<br>状态：'+box[0]+'</div>',
						    onShow: function(){
						    	var color = $(this).attr('color');
								$(this).tooltip('tip').css({
									backgroundColor:color,
								});
						    }
						});	;
             		}
             		console.log(rowData.name);
             		$('.title').html(rowData.name);
             		$('#cardsDialog').dialog('open');
             	}
             });
        }
        else {
            $.messager.alert("提示", "请选择其中一条信息", "info");
        }
  	}
  	
  	function doModifyDept(){
  		
  	}
  	
  	function doQuery(){
  		options.queryParams = $('#queryForm').serializeObject();
  		$('#dg').datagrid(options);
  	}
  </script>
</html>
