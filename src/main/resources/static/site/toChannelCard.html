<!DOCTYPE html>
<html>
  <head>
    <title>副卡管理</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<link rel="stylesheet" type="text/css" href="../css/easyui/themes/default/easyui.css" rel="stylesheet" title="blue"/>
	<link rel="stylesheet" type="text/css" href="../css/easyui/themes/icon.css"/>
	<script type="text/javascript" src="../js/jquery-1.6.3.min.js"></script>
	<script type="text/javascript" src="../js/jquery.easyui.min.js"></script>
	<script type="text/javascript" src="../js/easyui-lang-zh_CN.js"></script>
	<script type="text/javascript" src="../js/common.js"></script>
  </head>
  <body>
  
  		<div id="tt" class="easyui-tabs">	
	    <div title="	副卡管理概要信息" style="" iconCls="icon icon-outline">
			副卡概要信息
	    </div>
	    <div title="副卡列表" iconCls="icon icon-device">
		  	<form id="queryForm">
		  		<table class="table">
		  			<tr>
		  				<th>副卡号码：</th><td><input name="number" placeholder="请输入副卡号码" onkeyup="this.value=this.value.replace(/\D/,'')"/></td>
		  				<th>运营商：</th><td><input name="operatorCode" placeholder="请输入运营商编号"/></td>
<!-- 		  				<th>卡池状态：</th> -->
<!-- 		  				<td><select name="isActive" placeholder="请输入卡池名称"><option value="">全部</option><option  value="1">正常</option><option value="0">暂停</option></select></td> -->
		  				<td><a id="search_btn" class="easyui-linkbutton" iconCls="icon-search" plain="true" onclick="doQuery()">查 询</a></td>
		  			</tr>
		  		</table>
		  	</form>
		  	  <div id="win" class="easyui-window" title="副卡修改信息"  closed="true" style="width:500px;">
					<form style="padding:10px 20px 10px 40px;">
				<table class="table">
		  			<tr>
		  				<th>主键标识：</th><td><input name="ID" class="onlyNumber"/></td>
		  				<th>IMSI：</th><td><input name="IMSI" class="onlyNumber"/></td>
		  				<th>卡号：</th><td><input name="NUMBER" class="onlyNumber"/></td>
		  				<th>ICCID：</th><td><input name="ICCID" class="onlyNumber"/></td>
		  				<th>运营商编码：</th><td><input name="OPERATORCODE" class="onlyNumber"/></td>
		  				<th>国家编码：</th><td><input name="COUNTRYCODE" class="onlyNumber"/></td>
		  				<th>短信中心号码：</th><td><input name="MCNUMBER" class="onlyNumber"/></td>
		  				<th>最后一次充值时间：</th><td><input name="RECHARGETIME" class="onlyNumber"/></td>
		  				<th>账户余额：</th><td><input name="BALANCE" class="onlyNumber"/></td>
		  				<th>通道卡状态：</th><td><input name="STATUS" class="onlyNumber"/></td>
		  				<th>详情：</th><td><input name="DETAIL" class="onlyNumber"/></td>
		  			</tr>
		  		</table>
						<div style="padding:5px;text-align:center;">
							<a href="#" class="easyui-linkbutton" icon="icon-ok">保存</a>
							<a href="#" class="easyui-linkbutton" icon="icon-cancel">取消</a>
						</div>
					</form>
				</div>
			<div id="accWin" class="easyui-window" title="添加副卡"  closed="true" style="width:500px;">
					<form style="padding:10px 20px 10px 40px;">
				<table class="table">
		  			<tr>
		  				<th>主键标识：</th><td><input name="ID" class="onlyNumber"/></td>
		  				<th>IMSI：</th><td><input name="IMSI" class="onlyNumber"/></td>
		  				<th>卡号：</th><td><input name="NUMBER" class="onlyNumber"/></td>
		  				<th>ICCID：</th><td><input name="ICCID" class="onlyNumber"/></td>
		  				<th>运营商编码：</th><td><input name="OPERATORCODE" class="onlyNumber"/></td>
		  				<th>国家编码：</th><td><input name="COUNTRYCODE" class="onlyNumber"/></td>
		  				<th>短信中心号码：</th><td><input name="MCNUMBER" class="onlyNumber"/></td>
		  				<th>最后一次充值时间：</th><td><input name="RECHARGETIME" class="onlyNumber"/></td>
		  				<th>账户余额：</th><td><input name="BALANCE" class="onlyNumber"/></td>
		  				<th>通道卡状态：</th><td><input name="STATUS" class="onlyNumber"/></td>
		  				<th>详情：</th><td><input name="DETAIL" class="onlyNumber"/></td>
		  			</tr>
		  		</table>
						<div style="padding:5px;text-align:center;">
							<a href="#" class="easyui-linkbutton" icon="icon-ok">保存</a>
							<a href="#" class="easyui-linkbutton" icon="icon-cancel">取消</a>
						</div>
					</form>
				</div>
		    
		  	<div id="dg">
		  	</div>
		    <div id="cardsDialog" closed="true" style="padding:10px 20px;overflow:hidden;background:#FFFFFF;" iconCls="icon-user">
		    	<div class="title"></div>
		    	<div class="card_container" >
		    	</div>
		    </div>
		     
	    </div>
	</div>
	
	<script type="text/javascript">
  	$('#tt').css('height',window.innerHeight*0.98+'px');
  	var options={
			title:'副卡列表',
			queryParams:$('#queryForm').serializeObject(),
			columns:[[
						{field:'ck',checkbox:true}, 
			         	{field:'id',title:'副卡id',hidden:true},
			         	{field:'imsi',title:'IMSI',width:80},
			         	{field:'number',title:'卡号',width:100},
// 			         	{field:'status',title:'状态',width:100,formatter:function(value,rec,index){
// 			         		return '<div style="color:#fff;width:90px;text-align:center;background:'+(value=="1"?colors.blue:colors.red)+'">'+(value=="1"?"正常":"暂停")+'</div>';
// 			         	}},
			         	{field:'operatorCode',title:'运营商',width:100},//
			         	{field:'countryCode',title:'国家',width:120},//
			         	{field:'mcNumber',title:'短信中心号码',width:100},//
			         	{field:'detail',title:'详情',width:100},//
					]],
			toolbar: [{
				  		iconCls: 'icon-yj-log',
				  		text:'查看副卡卡信息',
				  		handler: doCardsInfo
				  	  },'-',{
				  		iconCls: 'icon-edit',
				  		text:'修改副卡信息',
				  		handler: doModifyDept
				  	  },'-',{
				  		iconCls: 'icon-add',
				  		text:'增加副卡',
				  		handler: addChannelCard
				  	  },'-',{
					  		iconCls: 'icon-delete2',
					  		text:'删除副卡',
					  		handler: delChannelCard
					  	  }
				  	 ],
			url:getContextPath()+'/getChannelCards',
			iconCls:'icon-tip',
			nowrap:false,
			pagination:true,
			pageList:[15,30],
			rownumbers:true,
			scrollbarSize:0,
		};
  
	$(function(){
		$('#dg').datagrid(options);
		
		$('#cardsDialog').dialog({
			modal : true,
   			resizable:true,
   			width:800,
   			height:350,
   			cache: false,
			title : "卡池对应卡信息"
		});
	});
  function editChannel(){
	  
  }
  function doModifyDept(){
  		console.log('修改');
	     $('#win').window('open');
  	}
  function addChannelCard(){
	   $('#accWin').window('open');
  }
  function delChannelCard(){
	  
  }
  	function doCardsInfo(){
  		var selectRows = $('#dg').datagrid("getSelections");
  		if (selectRows.length > 0 && selectRows.length == 1) {
             var rowData = $('#dg').datagrid("getSelected");
             $.getJSON(getContextPath()+'/getSimCardByPool/'+rowData.id,function(data){
             	var cardList = data.rows;
             	if(cardList && cardList.length>0){
             		$('.card_container').html('');
             		var total = rowData.type?rowData.type:cardList.length;
             		var count = 0;
             		for(var i = 0;i < total;i++){
             			var box = v_status["1"];
             			if((count < cardList.length) && ((i+1) == cardList[count].cpChannelId)){
             				box = v_status[cardList[count].status];
             				count ++;
             			}
             			$('<div class="box" color="'+box[1]+'" style="background:'+box[1]+'"></div>').appendTo($('.card_container'))
             			.tooltip({
						    position: 'top',
						    content: '<div style="padding:5px 10px;color:#fff">通道编号：'+(i+1)+'<br>状态：'+box[0]+'</div>',
						    onShow: function(){
						    	var color = $(this).attr('color');
								$(this).tooltip('tip').css({
									backgroundColor:color,
								});
						    }
						});	;
             		}
             		console.log(rowData.name);
             		$('.title').html(rowData.name+' （'+rowData.type+'）');
             		$('#cardsDialog').dialog('open');
             	}
             });
       } 	
        else {
            $.messager.alert("提示", "请选择其中一条信息", "info");
        }
  	}

 
  	function doQuery(){
  		options.queryParams = $('#queryForm').serializeObject();
  		$('#dg').datagrid(options);
  	}
  	
  	function doGivePool(){
  	}
  </script>
	
	
  </body>
</html>
