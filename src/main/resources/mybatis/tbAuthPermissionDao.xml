<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.team.dao.auth.TbAuthPermissionDao">

	<select id="getMenuByRole" resultType="com.team.model.auth.TbAuthPermission" parameterType="com.team.model.auth.TbAuthRole">
		select p.* 
		from tb_auth_permission p,
			 tb_auth_role_permission rp
		where p.id=rp.permission_id
		  and p.status=0 
		  and p.is_menu=1
		  and rp.status=0
		  and rp.role_id in(<foreach collection="list" item="item" separator=",">#{item.id,jdbcType=INTEGER}</foreach>)
		order by parent_id,order_num
	</select>
	
	<select id="getFunByRole" resultType="com.team.model.auth.TbAuthPermission" parameterType="java.util.Map">
		select p.* 
		from tb_auth_permission p,
			 tb_auth_role_permission rp
		where p.id=rp.permission_id
		  and p.status=0 
		  and p.is_menu=0
		  and rp.status=0
		  and rp.role_id in(<foreach collection="list" item="item" separator=",">#{item.id,jdbcType=INTEGER}</foreach>)
		  and p.parent_id=#{parentId,jdbcType=VARCHAR}
		order by order_num
	</select>
	
	<select id="getAllPermission" resultType="com.team.model.auth.TbAuthPermission">
		select * 
		from tb_auth_permission
		where status=0 
		order by parent_id,order_num 
	</select>
	
	<select id="getPermissionByUser" resultType="java.util.Map">
		select p.id
		from tb_auth_permission p,
			 tb_auth_role_permission rp,
			 tb_auth_role r,
			 tb_auth_user_role ur,
			 m_customer c
		where p.id=rp.permission_id
		  and rp.role_id=r.id
	      and r.id=ur.role_id
		  and ur.user_id=c.id
		  and p.status=0
		  and rp.status=0
		  and r.status=0
		  and ur.status=0
		  and c.status=0
		  and c.id=#{id,jdbcType=INTEGER}
	</select>
</mapper>
