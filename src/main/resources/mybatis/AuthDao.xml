<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.team.dao.AuthDao">
    <select id="getMenuByRole" resultType="com.team.model.auth.TbAuthPermission" parameterType="com.team.model.auth.TbAuthRole">
		select p.* 
		from tb_auth_permission p,
			 tb_auth_role_permission rp
		where p.id=rp.permission_id
		  and p.status=0 
		  and p.is_menu=1
		  and rp.status=0
		  and rp.role_id in(<foreach collection="list" item="item" separator=",">#{item.id,jdbcType=INTEGER}</foreach>)
		order by parent_id,order_num
	</select>
	
	<select id="getFunByRoleId" resultType="com.team.model.auth.TbAuthPermission">
		select * 
		from tb_auth_permission 
		where parent_id=#{parentId,jdbcType=INTEGER}
		  and is_menu=0
		order by order_num
	</select>
	
	<select id="getAllPermission" resultType="com.team.model.auth.TbAuthPermission">
		select * 
		from tb_auth_permission
		where status=0 
		order by parent_id,order_num 
	</select>
	
	<select id="getUserByName" resultType="com.team.model.auth.TbAuthUser">
		select r.id,
			   r.name userName,
			   r.password,
			   r.departmentId,
			   d.name departmentName
		from  m_customer r,
			  m_department d
		where r.departmentId=d.id
		  and r.name=#{name,jdbcType=VARCHAR}
		  and r.status=0
	</select>
	
	<select id="getRolesByUser" resultType="com.team.model.auth.TbAuthRole">
		select r.id,
			   r.name,
			   r.code
		from tb_auth_role r,
				 tb_auth_user_role ur
		where r.id=ur.role_id
		  and r.`status`=0
		  and ur.`status`=0
		  and ur.user_id=#{id,jdbcType=INTEGER}
	</select>
	
</mapper>
