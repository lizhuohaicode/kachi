<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.team.dao.TerminalDao">

	<sql id="departmentId">
		<if test="departmentId!=null" >  
         	and r.departmentId = #{departmentId,jdbcType=INTEGER}  
        </if>
	</sql>

	<select id="getTerminalByDeparment" resultType="com.team.model.Terminal" parameterType="java.util.Map">
		select r.id,
			  r.tsid,
			  r.mac,
			  r.model,
			  r.batch,
			  r.sVersion,
			  r.key,
			  r.status,
			  r.upLog,
			  r.imei,
			  r.activated,
			  r.homeLocation,
			  r.ssid,
			  r.wifiPassword,
			  r.licFix,
			  r.usedVpn,
			  r.usedSoft,
			  r.departmentId,
			  r.meid,
			  r.saleType,
			  r.resetWifi,
			  r.androidVersion,
			  t.name departmentName,
			  k.countryname countryName
		from m_terminal r
		left join m_department t
		on r.departmentId=t.id
		   and t.status=0
		left join m_country k 
		on k.countrycode=r.homeLocation
		where 1=1
		<include refid="departmentId"/>
		<if test="tsid!=null" >  
         	and r.tsid = #{tsid,jdbcType=INTEGER}  
        </if>
		<if test="status!=null" >  
         	and r.status = #{status,jdbcType=INTEGER}  
        </if>
		<if test="activated!=null" >  
         	and r.activated = #{activated,jdbcType=INTEGER}  
        </if>
	</select> 
	
</mapper>